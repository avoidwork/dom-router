{"version":3,"file":"dom-router.js","sources":["../../../../src/constants.js","../../../../src/route.js","../../../../src/router.js"],"sourcesContent":["export const cssCurrent = \"dr-current\";\nexport const cssHidden = \"dr-hidden\";\nexport const delimiter = \"/\";\nexport const empty = \"\";\nexport const hash = \"#\";\nexport const notHash = /.*\\#/;\nexport const render = window.requestAnimationFrame;\nexport const selectorHasHash = \"a[href^='#']\";\n","class Route {\n\tconstructor (cfg) {\n\t\tthis.hash = cfg.hash;\n\t\tthis.element = cfg.element;\n\t\tthis.trigger = cfg.trigger;\n\t\tthis.timestamp = new Date().toISOString();\n\t}\n}\n\nexport function route (cfg = {element: null, hash: \"\", trigger: null}) {\n\treturn new Route(cfg);\n}\n","import {cssCurrent, cssHidden, delimiter as slash, empty, hash, notHash, render, selectorHasHash} from \"./constants.js\";\nimport {route} from \"./route.js\";\n\nclass Router {\n\tconstructor ({active = true, callback = function () {}, css = {current: cssCurrent, hidden: cssHidden}, ctx = document.body, start = null, delimiter = slash, logging = false, stickyPos = true, stickyRoute = true, stop = true, storage = \"session\", storageKey = \"lastRoute\"} = {}) {\n\t\tthis.active = active;\n\t\tthis.callback = callback;\n\t\tthis.css = css;\n\t\tthis.ctx = ctx;\n\t\tthis.delimiter = delimiter;\n\t\tthis.history = [];\n\t\tthis.logging = logging;\n\t\tthis.routes = [];\n\t\tthis.stickyPos = stickyPos;\n\t\tthis.stickyRoute = stickyRoute;\n\t\tthis.storage = storage === \"session\" ? sessionStorage : localStorage;\n\t\tthis.storageKey = storageKey;\n\t\tthis.stop = stop;\n\t\tthis.start = this.stickyRoute ? this.storage.getItem(this.storageKey) || start : start;\n\t}\n\n\tcurrent () {\n\t\treturn this.history[this.history.length - 1];\n\t}\n\n\thandler () {\n\t\tconst oldHash = this.history.length > 0 ? (this.current().hash || empty).replace(notHash, empty) || null : null,\n\t\t\tnewHash = location.hash.includes(hash) ? location.hash.replace(notHash, empty) : null;\n\n\t\tif (this.active && this.valid(newHash)) {\n\t\t\tif (!this.routes.includes(newHash)) {\n\t\t\t\tthis.route(this.routes.filter(i => i.includes(newHash))[0] || this.start);\n\t\t\t} else {\n\t\t\t\tconst y = document.body.scrollTop,\n\t\t\t\t\toldHashes = oldHash ? oldHash.split(this.delimiter) : [],\n\t\t\t\t\tnewHashes = newHash.split(this.delimiter),\n\t\t\t\t\tremove = [];\n\t\t\t\tlet oldRoute = empty;\n\n\t\t\t\tfor (const loldHash of oldHashes) {\n\t\t\t\t\toldRoute += `${oldRoute.length > 0 ? `${this.delimiter}` : empty}${loldHash}`;\n\t\t\t\t\tremove.push(...this.select(`a[href=\"#${oldRoute}\"]`));\n\t\t\t\t}\n\n\t\t\t\trender(() => {\n\t\t\t\t\tlet newEl, newTrigger;\n\n\t\t\t\t\tfor (const i of remove) {\n\t\t\t\t\t\ti.classList.remove(this.css.current);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const idx of newHashes.keys()) {\n\t\t\t\t\t\tconst nth = idx + 1,\n\t\t\t\t\t\t\tvalid = oldHashes.length >= nth,\n\t\t\t\t\t\t\toldEl = valid ? this.select(`#${oldHashes.slice(0, nth).join(\" #\")}`) : void 0,\n\t\t\t\t\t\t\toldTrigger = valid ? this.select(`a[href='#${oldHashes.slice(0, nth).join(this.delimiter)}']`) : void 0;\n\n\t\t\t\t\t\tnewEl = this.select(`#${newHashes.slice(0, nth).join(\" #\")}`);\n\t\t\t\t\t\tnewTrigger = this.select(`a[href='#${newHashes.slice(0, nth).join(this.delimiter)}']`);\n\t\t\t\t\t\tthis.load(oldTrigger, oldEl, newTrigger, newEl);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.stickyRoute) {\n\t\t\t\t\t\tthis.storage.setItem(this.storageKey, newHash);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.stickyPos) {\n\t\t\t\t\t\tdocument.body.scrollTop = y;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst r = route({\n\t\t\t\t\t\telement: newEl,\n\t\t\t\t\t\thash: newHash,\n\t\t\t\t\t\ttrigger: newTrigger\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.log(r);\n\t\t\t\t\tthis.callback(r);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tload (oldTrigger = [], oldEl = [], newTrigger = [], newEl = []) {\n\t\tfor (const i of oldTrigger) {\n\t\t\ti.classList.remove(this.css.current);\n\t\t}\n\n\t\tfor (const [idx, i] of oldEl.entries()) {\n\t\t\tif (i.id !== newEl[idx]?.id) {\n\t\t\t\ti.classList.add(this.css.hidden);\n\t\t\t}\n\t\t}\n\n\t\tfor (const i of newTrigger) {\n\t\t\ti.classList.add(this.css.current);\n\t\t}\n\n\t\tfor (const i of newEl) {\n\t\t\tthis.sweep(i, this.css.hidden);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tlog (arg) {\n\t\tthis.history.push(this.logging ? arg : {hash: arg.hash});\n\n\t\treturn this;\n\t}\n\n\tpopstate (ev) {\n\t\tthis.handler(ev);\n\n\t\treturn this;\n\t}\n\n\tprocess () {\n\t\tconst lhash = document.location.hash.replace(hash, empty);\n\n\t\tthis.scan(this.start);\n\n\t\tif (!this.ctx.classList.contains(this.css.hidden)) {\n\t\t\tif (lhash.length > 0 && this.routes.includes(lhash)) {\n\t\t\t\tthis.handler();\n\t\t\t} else {\n\t\t\t\tthis.route(this.start);\n\t\t\t}\n\t\t}\n\t}\n\n\troute (arg = empty) {\n\t\tdocument.location.hash = arg;\n\n\t\treturn this;\n\t}\n\n\tselect (arg) {\n\t\treturn Array.from(this.ctx.querySelectorAll.call(this.ctx, arg)).filter(i => i !== null);\n\t}\n\n\tscan (input = empty) {\n\t\tconst arg = input === null ? empty : input;\n\n\t\tthis.routes = Array.from(new Set(this.select(selectorHasHash).map(i => i.href.replace(notHash, empty)).filter(i => i !== empty)));\n\n\t\tif (arg.length > 0 && !this.routes.includes(arg)) {\n\t\t\tthis.routes.push(arg);\n\t\t}\n\n\t\tthis.start = arg || this.routes[0] || null;\n\n\t\treturn this;\n\t}\n\n\tsweep (obj, klass) {\n\t\trender(() => {\n\t\t\tArray.from(obj.parentNode.childNodes).filter(i => i.nodeType === 1 && i.id && i.id !== obj.id).forEach(i => i.classList.add(klass));\n\t\t\tobj.classList.remove(klass);\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tvalid (arg = empty) {\n\t\treturn arg === empty || (/=/).test(arg) === false;\n\t}\n}\n\nexport function router (arg) {\n\tconst obj = new Router(arg);\n\n\tobj.popstate = obj.popstate.bind(obj);\n\n\tif (\"addEventListener\" in window) {\n\t\twindow.addEventListener(\"popstate\", obj.popstate, false);\n\t} else {\n\t\twindow.onpopstate = obj.popstate;\n\t}\n\n\tif (obj.active) {\n\t\tobj.process();\n\t}\n\n\treturn obj;\n}\n"],"names":["empty","notHash","render","window","requestAnimationFrame","Route","constructor","cfg","this","hash","element","trigger","timestamp","Date","toISOString","Router","active","callback","css","current","hidden","ctx","document","body","start","delimiter","logging","stickyPos","stickyRoute","stop","storage","storageKey","history","routes","sessionStorage","localStorage","getItem","length","handler","oldHash","replace","newHash","location","includes","valid","y","scrollTop","oldHashes","split","newHashes","remove","oldRoute","loldHash","push","select","newEl","newTrigger","i","classList","idx","keys","nth","oldEl","slice","join","oldTrigger","load","setItem","r","route","log","filter","entries","id","add","sweep","arg","popstate","ev","process","lhash","scan","contains","Array","from","querySelectorAll","call","input","Set","map","href","obj","klass","parentNode","childNodes","nodeType","forEach","test","exports","router","bind","addEventListener","onpopstate","Object","defineProperty","value"],"mappings":";;;;iPAAO,MAGMA,EAAQ,GAERC,EAAU,OACVC,EAASC,OAAOC,sBCN7B,MAAMC,EACLC,YAAaC,GACZC,KAAKC,KAAOF,EAAIE,KAChBD,KAAKE,QAAUH,EAAIG,QACnBF,KAAKG,QAAUJ,EAAII,QACnBH,KAAKI,WAAY,IAAIC,MAAOC,aAC5B,ECHF,MAAMC,EACLT,aAAaU,OAACA,GAAS,EAAIC,SAAEA,EAAW,WAAY,EAAEC,IAAEA,EAAM,CAACC,QFJtC,aEI2DC,OFH5D,aEG8EC,IAAEA,EAAMC,SAASC,KAAIC,MAAEA,EAAQ,KAAMC,UAAAA,EFFnH,IEEoIC,QAAEA,GAAU,EAAKC,UAAEA,GAAY,EAAIC,YAAEA,GAAc,EAAIC,KAAEA,GAAO,EAAIC,QAAEA,EAAU,UAASC,WAAEA,EAAa,aAAe,IAClRvB,KAAKQ,OAASA,EACdR,KAAKS,SAAWA,EAChBT,KAAKU,IAAMA,EACXV,KAAKa,IAAMA,EACXb,KAAKiB,UAAYA,EACjBjB,KAAKwB,QAAU,GACfxB,KAAKkB,QAAUA,EACflB,KAAKyB,OAAS,GACdzB,KAAKmB,UAAYA,EACjBnB,KAAKoB,YAAcA,EACnBpB,KAAKsB,QAAsB,YAAZA,EAAwBI,eAAiBC,aACxD3B,KAAKuB,WAAaA,EAClBvB,KAAKqB,KAAOA,EACZrB,KAAKgB,MAAQhB,KAAKoB,aAAcpB,KAAKsB,QAAQM,QAAQ5B,KAAKuB,aAAuBP,CACjF,CAEDL,UACC,OAAOX,KAAKwB,QAAQxB,KAAKwB,QAAQK,OAAS,EAC1C,CAEDC,UACC,MAAMC,EAAU/B,KAAKwB,QAAQK,OAAS,IAAK7B,KAAKW,UAAUV,MAAQT,GAAOwC,QAAQvC,EAASD,IAAiB,KAC1GyC,EAAUC,SAASjC,KAAKkC,SFvBP,KEuBwBD,SAASjC,KAAK+B,QAAQvC,EAASD,GAAS,KAElF,GAAIQ,KAAKQ,QAAUR,KAAKoC,MAAMH,GAC7B,GAAKjC,KAAKyB,OAAOU,SAASF,GAEnB,CACN,MAAMI,EAAIvB,SAASC,KAAKuB,UACvBC,EAAYR,EAAUA,EAAQS,MAAMxC,KAAKiB,WAAa,GACtDwB,EAAYR,EAAQO,MAAMxC,KAAKiB,WAC/ByB,EAAS,GACV,IAAIC,EAAWnD,EAEf,IAAK,MAAMoD,KAAYL,EACtBI,GAAY,GAAGA,EAASd,OAAS,EAAI,GAAG7B,KAAKiB,YAAczB,IAAQoD,IACnEF,EAAOG,QAAQ7C,KAAK8C,OAAO,YAAYH,QAGxCjD,GAAO,KACN,IAAIqD,EAAOC,EAEX,IAAK,MAAMC,KAAKP,EACfO,EAAEC,UAAUR,OAAO1C,KAAKU,IAAIC,SAG7B,IAAK,MAAMwC,KAAOV,EAAUW,OAAQ,CACnC,MAAMC,EAAMF,EAAM,EACjBf,EAAQG,EAAUV,QAAUwB,EAC5BC,EAAQlB,EAAQpC,KAAK8C,OAAO,IAAIP,EAAUgB,MAAM,EAAGF,GAAKG,KAAK,cAAW,EACxEC,EAAarB,EAAQpC,KAAK8C,OAAO,YAAYP,EAAUgB,MAAM,EAAGF,GAAKG,KAAKxD,KAAKiB,qBAAkB,EAElG8B,EAAQ/C,KAAK8C,OAAO,IAAIL,EAAUc,MAAM,EAAGF,GAAKG,KAAK,SACrDR,EAAahD,KAAK8C,OAAO,YAAYL,EAAUc,MAAM,EAAGF,GAAKG,KAAKxD,KAAKiB,gBACvEjB,KAAK0D,KAAKD,EAAYH,EAAON,EAAYD,EACzC,CAEG/C,KAAKoB,aACRpB,KAAKsB,QAAQqC,QAAQ3D,KAAKuB,WAAYU,GAGnCjC,KAAKmB,YACRL,SAASC,KAAKuB,UAAYD,GAG3B,MAAMuB,ED7DJ,SAAgB7D,EAAM,CAACG,QAAS,KAAMD,KAAM,GAAIE,QAAS,OAC/D,OAAO,IAAIN,EAAME,EAClB,CC2De8D,CAAM,CACf3D,QAAS6C,EACT9C,KAAMgC,EACN9B,QAAS6C,IAGVhD,KAAK8D,IAAIF,GACT5D,KAAKS,SAASmD,EAAE,GAEjB,MAhDA5D,KAAK6D,MAAM7D,KAAKyB,OAAOsC,QAAOd,GAAKA,EAAEd,SAASF,KAAU,IAAMjC,KAAKgB,OAmDrE,OAAOhB,IACP,CAED0D,KAAMD,EAAa,GAAIH,EAAQ,GAAIN,EAAa,GAAID,EAAQ,IAC3D,IAAK,MAAME,KAAKQ,EACfR,EAAEC,UAAUR,OAAO1C,KAAKU,IAAIC,SAG7B,IAAK,MAAOwC,EAAKF,KAAMK,EAAMU,UACxBf,EAAEgB,KAAOlB,EAAMI,IAAMc,IACxBhB,EAAEC,UAAUgB,IAAIlE,KAAKU,IAAIE,QAI3B,IAAK,MAAMqC,KAAKD,EACfC,EAAEC,UAAUgB,IAAIlE,KAAKU,IAAIC,SAG1B,IAAK,MAAMsC,KAAKF,EACf/C,KAAKmE,MAAMlB,EAAGjD,KAAKU,IAAIE,QAGxB,OAAOZ,IACP,CAED8D,IAAKM,GAGJ,OAFApE,KAAKwB,QAAQqB,KAAK7C,KAAKkB,QAAUkD,EAAM,CAACnE,KAAMmE,EAAInE,OAE3CD,IACP,CAEDqE,SAAUC,GAGT,OAFAtE,KAAK8B,QAAQwC,GAENtE,IACP,CAEDuE,UACC,MAAMC,EAAQ1D,SAASoB,SAASjC,KAAK+B,QFpHnB,IEoHiCxC,GAEnDQ,KAAKyE,KAAKzE,KAAKgB,OAEVhB,KAAKa,IAAIqC,UAAUwB,SAAS1E,KAAKU,IAAIE,UACrC4D,EAAM3C,OAAS,GAAK7B,KAAKyB,OAAOU,SAASqC,GAC5CxE,KAAK8B,UAEL9B,KAAK6D,MAAM7D,KAAKgB,OAGlB,CAED6C,MAAOO,EAAM5E,IAGZ,OAFAsB,SAASoB,SAASjC,KAAOmE,EAElBpE,IACP,CAED8C,OAAQsB,GACP,OAAOO,MAAMC,KAAK5E,KAAKa,IAAIgE,iBAAiBC,KAAK9E,KAAKa,IAAKuD,IAAML,QAAOd,GAAW,OAANA,GAC7E,CAEDwB,KAAMM,EAAQvF,IACb,MAAM4E,EAAgB,OAAVW,EAAiBvF,EAAQuF,EAUrC,OARA/E,KAAKyB,OAASkD,MAAMC,KAAK,IAAII,IAAIhF,KAAK8C,OF3IT,gBE2IiCmC,KAAIhC,GAAKA,EAAEiC,KAAKlD,QAAQvC,EAASD,KAAQuE,QAAOd,GAAKA,IAAMzD,MAErH4E,EAAIvC,OAAS,IAAM7B,KAAKyB,OAAOU,SAASiC,IAC3CpE,KAAKyB,OAAOoB,KAAKuB,GAGlBpE,KAAKgB,MAAQoD,GAAOpE,KAAKyB,OAAO,IAAM,KAE/BzB,IACP,CAEDmE,MAAOgB,EAAKC,GAMX,OALA1F,GAAO,KACNiF,MAAMC,KAAKO,EAAIE,WAAWC,YAAYvB,QAAOd,GAAoB,IAAfA,EAAEsC,UAAkBtC,EAAEgB,IAAMhB,EAAEgB,KAAOkB,EAAIlB,KAAIuB,SAAQvC,GAAKA,EAAEC,UAAUgB,IAAIkB,KAC5HD,EAAIjC,UAAUR,OAAO0C,EAAM,IAGrBpF,IACP,CAEDoC,MAAOgC,EAAM5E,IACZ,OAAO4E,IAAQ5E,IAA6B,IAApB,IAAMiG,KAAKrB,EACnC,EAmBFsB,EAAAC,OAhBO,SAAiBvB,GACvB,MAAMe,EAAM,IAAI5E,EAAO6D,GAcvB,OAZAe,EAAId,SAAWc,EAAId,SAASuB,KAAKT,GAE7B,qBAAsBxF,OACzBA,OAAOkG,iBAAiB,WAAYV,EAAId,UAAU,GAElD1E,OAAOmG,WAAaX,EAAId,SAGrBc,EAAI3E,QACP2E,EAAIZ,UAGEY,CACR,EAAAY,OAAAC,eAAAN,EAAA,aAAA,CAAAO,OAAA,GAAA"}