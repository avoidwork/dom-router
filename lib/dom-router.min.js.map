{"version":3,"file":"dom-router.min.js","sources":["dom-router.js"],"names":["document","window","contains","obj","arg","indexOf","Route","this","hash","element","trigger","timestamp","Date","toISOString","route","Router","active","callback","css","ctx","delimiter","history","log","routes","select","stop","router","hashes","t","r","location","replace","addEventListener","hashchange","bind","onhashchange","undefined","current","hidden","querySelectorAll","body","slice","call","filter","i","href","map","not_hash","classList","split","forEach","idx","a","querySelector","sweep","join","add","render","time","getTime","requestAnimationFrame","fn","offset","setTimeout","prototype","constructor","ev","oldHash","oldURL","newHash","newURL","preventDefault","stopPropagation","newEl","newTrigger","oldHashes","newHashes","nth","valid","length","oldEl","oldTrigger","load","remove","unshift","id","klass","parentNode","childNodes","nodeType","exports","module","define"],"mappings":"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","sourcesContent":["/**\n * URL hash to DOM router\n *\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\n * @copyright 2014 Jason Mulligan\n * @license BSD-3 <https://raw.github.com/avoidwork/dom-router/master/LICENSE>\n * @link http://avoidwork.github.io/dom-router\n * @module dom-router\n * @version 1.0.0\n */\n( function ( document, window ) {\n\"use strict\";\n\nvar not_hash = /.*\\#/,\n\ttime = new Date().getTime(),\n\trender;\n\nrender = window.requestAnimationFrame || function ( fn ) {\n\tvar offset = new Date().getTime() - time;\n\n\tsetTimeout( function () {\n\t\tfn( offset );\n\t}, 16 );\n};\n\n/**\n * Determines if `arg` is in `obj`\n *\n * @method contains\n * @param  {Mixed} obj Object to inspect\n * @param  {Mixed} arg Value to find\n * @return {Boolean}   `true` if found\n */\nfunction contains ( obj, arg ) {\n\treturn obj.indexOf( arg ) > -1;\n}\n\n/**\n * Route\n *\n * @param {Object} arg Descriptor\n * @constructor\n */\nfunction Route ( arg ) {\n\tthis.hash = arg.hash;\n\tthis.element = arg.element;\n\tthis.trigger = arg.trigger;\n\tthis.timestamp = new Date().toISOString();\n}\n\n/**\n * Route factory\n *\n * @method route\n * @param  {Object} arg Descriptor\n * @return {Object}     Route\n */\nfunction route ( arg ) {\n\treturn new Route( arg );\n}\n\n/**\n * URL hash to DOM router\n *\n * @constructor\n */\nfunction Router () {\n\tthis.active = true;\n\tthis.callback = null;\n\tthis.css = null;\n\tthis.ctx = null;\n\tthis[ \"default\" ] = null;\n\tthis.delimiter = null;\n\tthis.history = [];\n\tthis.log = false;\n\tthis.routes = [];\n\tthis.select = null;\n\tthis.stop = true;\n}\n\n/**\n * Setting constructor loop\n *\n * @type {Object}\n */\nRouter.prototype.constructor = Router;\n\n/**\n * Returns the current route descriptor\n *\n * @method current\n * @return {Object} Route descriptor\n */\nRouter.prototype.current = function () {\n\treturn this.history[ 0 ];\n};\n\n/**\n * Hash change handler\n *\n * @method hashchange\n * @param  {Object} Event\n * @return {Undefined} undefined\n */\nRouter.prototype.hashchange = function ( ev ) {\n\tvar oldHash = contains( ev.oldURL, \"#\" ) ? ev.oldURL.replace( not_hash, \"\" ) : null,\n\t\tnewHash = contains( ev.newURL, \"#\" ) ? ev.newURL.replace( not_hash, \"\" ) : null;\n\n\tif ( this.active && ( oldHash ? contains( this.routes, oldHash ) : true ) && ( newHash ? contains( this.routes, newHash ) : false ) ) {\n\t\tif ( this.stop === true ) {\n\t\t\tev.preventDefault();\n\t\t\tev.stopPropagation();\n\t\t}\n\n\t\trender( function () {\n\t\t\tvar oldHashes = oldHash ? oldHash.split( this.delimiter ) : [],\n\t\t\t\tnewHashes = newHash.split( this.delimiter ),\n\t\t\t\tr, newEl, newTrigger;\n\n\t\t\tnewHashes.forEach( function ( i, idx ) {\n\t\t\t\tvar nth = idx + 1,\n\t\t\t\t\tvalid = oldHashes.length >= nth,\n\t\t\t\t\toldEl = valid ? this.select( \"#\" + oldHashes.slice( 0, nth ).join( \" > #\") )[0] : null,\n\t\t\t\t\toldTrigger = valid ? this.select( \"a[href='#\" + oldHashes.slice( 0, nth ).join( this.delimiter ) + \"']\" )[0] : null;\n\n\t\t\t\tnewEl = this.select( \"#\" + newHashes.slice( 0, nth ).join( \" > #\") )[0];\n\t\t\t\tnewTrigger = this.select( \"a[href='#\" + newHashes.slice( 0, nth ).join( this.delimiter ) + \"']\" )[0];\n\n\t\t\t\tthis.load( oldTrigger || null, oldEl || null, newTrigger || null, newEl || null );\n\t\t\t}, this );\n\n\t\t\tif ( this.css.current && this.history.length > 0 ) {\n\t\t\t\tthis.history[0 ].trigger.classList.remove( this.css.current );\n\t\t\t}\n\n\t\t\tr = route( { element: newEl || null, hash: newHash, trigger: newTrigger || null } );\n\n\t\t\tif ( this.log === true ) {\n\t\t\t\tthis.history.unshift( r );\n\t\t\t}\n\n\t\t\tif ( this.callback !== null ) {\n\t\t\t\tthis.callback( r );\n\t\t\t}\n\t\t}.bind( this ) );\n\t}\n};\n\n/**\n * Loads a route\n *\n * @method load\n * @param  {Object} arg Route descriptor\n * @return {Object}     Router\n */\nRouter.prototype.load = function ( oldTrigger, oldEl, newTrigger, newEl ) {\n\tif ( oldTrigger && this.css.current ) {\n\t\toldTrigger.classList.remove( this.css.current );\n\t}\n\n\tif ( oldEl && oldEl.id !== newEl.id ) {\n\t\toldEl.classList.add( this.css.hidden );\n\t}\n\n\tif ( newTrigger && this.css.current ) {\n\t\tnewTrigger.classList.add( this.css.current );\n\t}\n\n\tif ( newEl ) {\n\t\tthis.sweep( newEl, this.css.hidden );\n\t}\n\n\treturn this;\n};\n\n/**\n * Sets the route\n *\n * @method route\n * @param  {String} arg Route to set\n * @return {Object}     Router\n */\nRouter.prototype.route = function ( arg ) {\n\tdocument.location.hash = arg;\n\treturn this;\n};\n\n/**\n * Sweeps the surrounding nodes and toggles a class\n *\n * @method sweep\n * @param  {Object} obj\n * @param  {String} klass\n * @return {Object} Router\n */\nRouter.prototype.sweep = function ( obj, klass ) {\n\t[].slice.call( obj.parentNode.childNodes ).filter( function ( i ){\n\t\treturn i.nodeType === 1 && i.id && i.id !== obj.id;\n\t} ).forEach( function ( i ) {\n\t\ti.classList.add( klass );\n\t}, this );\n\n\tobj.classList.remove( klass );\n\n\treturn this;\n};\n\n/**\n * Router factory\n *\n * @param  {Object} arg Descriptor\n * @return {Object} Router\n */\nfunction router ( arg ) {\n\tvar r = new Router(),\n\t\thash = document.location.hash.replace( \"#\", \"\" ),\n\t\thashes, t;\n\n\t// Adding hook\n\tif ( typeof window.addEventListener == \"function\" ) {\n\t\twindow.addEventListener( \"hashchange\", r.hashchange.bind( r ), false );\n\t}\n\telse {\n\t\twindow.onhashchange = r.hashchange.bind( r );\n\t}\n\n\t// Setting properties\n\tr.active = arg.active !== undefined ? ( arg.active === true ) : true;\n\tr.callback = arg.callback || null;\n\tr.css = arg.css || { current: \"current\", hidden: \"hidden\" };\n\tr.ctx = arg.ctx && typeof arg.ctx.querySelectorAll == \"function\" ? arg.ctx : document.body;\n\tr.delimiter = arg.delimiter || \"/\";\n\tr.log = arg.log !== undefined ? ( arg.log === true ) : false;\n\tr.select = r.ctx.querySelectorAll.bind( r.ctx );\n\tr.stop = arg.stop !== undefined ? ( arg.stop === true ) : true;\n\n\tr.routes = [].slice.call( r.select( \"a\" ) ).filter( function ( i ) {\n\t\treturn contains( i.href, \"#\" );\n\t} ).map( function ( i ) {\n\t\treturn i.href.replace( not_hash, \"\" );\n\t} );\n\n\tr[ \"default\" ] = arg[ \"default\" ] || r.routes[ 0 ];\n\n\t// Setting state\n\tif ( !( r.css.hidden in r.ctx.classList ) ) {\n\t\tt = r.ctx;\n\n\t\tif ( hash !== \"\" && contains( r.routes, hash ) ) {\n\t\t\thashes = hash.split( r.delimiter );\n\t\t\thashes.forEach( function ( i, idx ) {\n\t\t\t\tvar a;\n\n\t\t\t\tt = t.querySelector( \"#\" + i );\n\n\t\t\t\tif ( t ) {\n\t\t\t\t\tr.sweep( t, r.css.hidden );\n\t\t\t\t}\n\n\t\t\t\tif ( r.css.current ) {\n\t\t\t\t\ta = r.select( \"a[href='#\" + hashes.slice( 0, idx + 1 ).join( r.delimiter ) + \"']\" )[ 0 ];\n\t\t\t\t\tif ( a ) {\n\t\t\t\t\t\ta.classList.add( r.css.current );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t\telse {\n\t\t\tr.route( r[ \"default\" ] );\n\t\t}\n\t}\n\n\treturn r;\n}\n\n// CJS, AMD & window supported\nif ( typeof exports != \"undefined\" ) {\n\tmodule.exports = router;\n}\nelse if ( typeof define == \"function\" ) {\n\tdefine( function () {\n\t\treturn router;\n\t} );\n}\nelse {\n\twindow.router = router;\n}\n} )( document, window );\n"]}