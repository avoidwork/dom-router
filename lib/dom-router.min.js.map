{"version":3,"file":"dom-router.min.js","sources":["dom-router.js"],"names":["document","window","contains","obj","arg","indexOf","Route","this","hash","element","trigger","timestamp","Date","toISOString","route","Router","active","callback","css","current","hidden","ctx","body","delimiter","history","log","routes","stop","router","facade","ev","r","hashchange","call","location","replace","addEventListener","onhashchange","Object","undefined","querySelectorAll","scan","classList","oldURL","newURL","render","not_hash","time","getTime","requestAnimationFrame","fn","offset","setTimeout","prototype","constructor","self","oldHash","newHash","preventDefault","stopPropagation","filter","i","newEl","newTrigger","oldHashes","split","newHashes","forEach","idx","nth","valid","length","oldEl","select","slice","join","oldTrigger","load","remove","unshift","id","add","sweep","href","map","klass","parentNode","childNodes","nodeType","exports","module","define"],"mappings":"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","sourcesContent":["/**\n * URL hash to DOM router\n *\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\n * @copyright 2014 Jason Mulligan\n * @license BSD-3 <https://raw.github.com/avoidwork/dom-router/master/LICENSE>\n * @link http://avoidwork.github.io/dom-router\n * @module dom-router\n * @version 1.0.2\n */\n( function ( document, window ) {\n\"use strict\";\n\nvar not_hash = /.*\\#/,\n\ttime = new Date().getTime(),\n\trender;\n\nrender = window.requestAnimationFrame || function ( fn ) {\n\tvar offset = new Date().getTime() - time;\n\n\tsetTimeout( function () {\n\t\tfn( offset );\n\t}, 16 );\n};\n\n/**\n * Determines if `arg` is in `obj`\n *\n * @method contains\n * @param  {Mixed} obj Object to inspect\n * @param  {Mixed} arg Value to find\n * @return {Boolean}   `true` if found\n */\nfunction contains ( obj, arg ) {\n\treturn obj.indexOf( arg ) > -1;\n}\n\n/**\n * Route\n *\n * @param {Object} arg Descriptor\n * @constructor\n */\nfunction Route ( arg ) {\n\tthis.hash = arg.hash;\n\tthis.element = arg.element;\n\tthis.trigger = arg.trigger;\n\tthis.timestamp = new Date().toISOString();\n}\n\n/**\n * Route factory\n *\n * @method route\n * @param  {Object} arg Descriptor\n * @return {Object}     Route\n */\nfunction route ( arg ) {\n\treturn new Route( arg );\n}\n\n/**\n * URL hash to DOM router\n *\n * @constructor\n */\nfunction Router () {\n\tthis.active = true;\n\tthis.callback = null;\n\tthis.css = { current: \"current\", hidden: \"hidden\" };\n\tthis.ctx = document.body;\n\tthis[ \"default\" ] = null;\n\tthis.delimiter = \"/\";\n\tthis.history = [];\n\tthis.log = false;\n\tthis.routes = [];\n\tthis.stop = true;\n}\n\n/**\n * Setting constructor loop\n *\n * @type {Object}\n */\nRouter.prototype.constructor = Router;\n\n/**\n * Returns the current route descriptor\n *\n * @method current\n * @return {Object} Route descriptor\n */\nRouter.prototype.current = function () {\n\treturn this.history[ 0 ];\n};\n\n/**\n * Hash change handler\n *\n * @method hashchange\n * @param  {Object} Event\n * @return {Undefined} undefined\n */\nRouter.prototype.hashchange = function ( ev ) {\n\tvar self = this,\n\t\toldHash = contains( ev.oldURL, \"#\" ) ? ev.oldURL.replace( not_hash, \"\" ) : null,\n\t\tnewHash = contains( ev.newURL, \"#\" ) ? ev.newURL.replace( not_hash, \"\" ) : null;\n\n\tif ( this.active ) {\n\t\tif ( this.stop === true && typeof ev.preventDefault == \"function\" ) {\n\t\t\tev.preventDefault();\n\t\t\tev.stopPropagation();\n\t\t}\n\n\t\t// Invalid route, looking for a suitable alternative with a fallback to 'default'\n\t\tif ( !contains( this.routes, newHash ) ) {\n\t\t\treturn this.route( this.routes.filter( function ( i ) {\n\t\t\t\treturn contains(i, newHash );\n\t\t\t} )[0] || this[\"default\"] );\n\t\t}\n\n\t\trender( function () {\n\t\t\tvar oldHashes = oldHash ? oldHash.split( self.delimiter ) : [],\n\t\t\t\tnewHashes = newHash.split( self.delimiter ),\n\t\t\t\tr, newEl, newTrigger;\n\n\t\t\tnewHashes.forEach( function ( i, idx ) {\n\t\t\t\tvar nth = idx + 1,\n\t\t\t\t\tvalid = oldHashes.length >= nth,\n\t\t\t\t\toldEl = valid ? self.select( \"#\" + oldHashes.slice( 0, nth ).join( \" > #\" ) )[ 0 ] : null,\n\t\t\t\t\toldTrigger = valid ? self.select( \"a[href='#\" + oldHashes.slice( 0, nth ).join( self.delimiter ) + \"']\" )[ 0 ] : null;\n\n\t\t\t\tnewEl = self.select( \"#\" + newHashes.slice( 0, nth ).join( \" > #\" ) )[ 0 ];\n\t\t\t\tnewTrigger = self.select( \"a[href='#\" + newHashes.slice( 0, nth ).join( self.delimiter ) + \"']\" )[ 0 ];\n\n\t\t\t\tself.load( oldTrigger || null, oldEl || null, newTrigger || null, newEl || null );\n\t\t\t}, this );\n\n\t\t\tif ( self.css.current && self.history.length > 0 ) {\n\t\t\t\tself.history[ 0 ].trigger.classList.remove( self.css.current );\n\t\t\t}\n\n\t\t\tr = route( { element: newEl || null, hash: newHash, trigger: newTrigger || null } );\n\n\t\t\tif ( self.log === true ) {\n\t\t\t\tself.history.unshift( r );\n\t\t\t}\n\n\t\t\tif ( self.callback !== null ) {\n\t\t\t\tself.callback( r );\n\t\t\t}\n\t\t} );\n\t}\n};\n\n/**\n * Loads a route\n *\n * @method load\n * @param  {Object} arg Route descriptor\n * @return {Object}     Router\n */\nRouter.prototype.load = function ( oldTrigger, oldEl, newTrigger, newEl ) {\n\tif ( oldTrigger && this.css.current ) {\n\t\toldTrigger.classList.remove( this.css.current );\n\t}\n\n\tif ( oldEl && oldEl.id !== newEl.id ) {\n\t\toldEl.classList.add( this.css.hidden );\n\t}\n\n\tif ( newTrigger && this.css.current ) {\n\t\tnewTrigger.classList.add( this.css.current );\n\t}\n\n\tif ( newEl ) {\n\t\tthis.sweep( newEl, this.css.hidden );\n\t}\n\n\treturn this;\n};\n\n/**\n * Sets the route\n *\n * @method route\n * @param  {String} arg Route to set\n * @return {Object}     Router\n */\nRouter.prototype.route = function ( arg ) {\n\tdocument.location.hash = arg;\n\treturn this;\n};\n\n/**\n * Makes a context specific DOM query\n *\n * @method select\n * @param  {String} arg CSS selector\n * @return {Array}      Array of matching nodes\n */\nRouter.prototype.select = function ( arg ) {\n\treturn [].slice.call( this.ctx.querySelectorAll.call( this.ctx, arg ) );\n};\n\n/**\n * Scans the DOM for routes\n *\n * @method scan\n * @param  {String} arg Default route\n * @return {Object}     Router\n */\nRouter.prototype.scan = function ( arg ) {\n\tthis.routes = this.select( \"a\" ).filter( function ( i ) {\n\t\treturn contains( i.href, \"#\" );\n\t} ).map( function ( i ) {\n\t\treturn i.href.replace( not_hash, \"\" );\n\t} );\n\n\tthis[ \"default\" ] = arg || this.routes[ 0 ];\n\treturn this;\n};\n\n/**\n * Sweeps the surrounding nodes and toggles a class\n *\n * @method sweep\n * @param  {Object} obj\n * @param  {String} klass\n * @return {Object} Router\n */\nRouter.prototype.sweep = function ( obj, klass ) {\n\t[].slice.call( obj.parentNode.childNodes ).filter( function ( i ) {\n\t\treturn i.nodeType === 1 && i.id && i.id !== obj.id;\n\t} ).forEach( function ( i ) {\n\t\ti.classList.add( klass );\n\t}, this );\n\n\tobj.classList.remove( klass );\n\treturn this;\n};\n\n/**\n * Router factory\n *\n * @param  {Object} arg Descriptor\n * @return {Object} Router\n */\nfunction router ( arg ) {\n\tvar r = new Router(),\n\t\thash = document.location.hash.replace( \"#\", \"\" );\n\n\tfunction facade ( ev ) {\n\t\tr.hashchange.call( r, ev );\n\t}\n\n\t// Adding hook\n\tif ( \"addEventListener\" in window ) {\n\t\twindow.addEventListener( \"hashchange\", facade, false );\n\t}\n\telse {\n\t\twindow.onhashchange = facade;\n\t}\n\n\t// Setting properties\n\tif ( arg instanceof Object ) {\n\t\tr.active = arg.active !== undefined ? ( arg.active === true ) : r.active;\n\t\tr.callback = arg.callback || r.callback;\n\t\tr.css = arg.css || r.css;\n\t\tr.ctx = arg.ctx && typeof arg.ctx.querySelectorAll == \"function\" ? arg.ctx : r.ctx;\n\t\tr.delimiter = arg.delimiter || r.delimiter;\n\t\tr.log = arg.log !== undefined ? ( arg.log === true ) : r.log;\n\t\tr.stop = arg.stop !== undefined ? ( arg.stop === true ) : r.stop;\n\t}\n\n\t// Scanning for routes\n\tr.scan( r[ \"default\" ] );\n\n\t// Setting state\n\tif ( !( r.css.hidden in r.ctx.classList ) ) {\n\t\tif ( hash !== \"\" && contains( r.routes, hash ) ) {\n\t\t\tr.hashchange( {oldURL: \"\", newURL: document.location.hash} );\n\t\t}\n\t\telse {\n\t\t\tr.route( r[ \"default\" ] );\n\t\t}\n\t}\n\n\treturn r;\n}\n\n// CJS, AMD & window supported\nif ( typeof exports != \"undefined\" ) {\n\tmodule.exports = router;\n}\nelse if ( typeof define == \"function\" ) {\n\tdefine( function () {\n\t\treturn router;\n\t} );\n}\nelse {\n\twindow.router = router;\n}\n} )( document, window );\n"]}